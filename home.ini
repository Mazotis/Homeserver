; Homeserver configuration file
; RPi3 related configurables
[SERVER]
; The RPI3 IP address
HOST = 000.000.000.000
; The RPI3 server port. Must be accessible thru firewall
PORT = 1111
; Allows to choose the VOICE server port, if the ifttt or dialogflow module is active
VOICE_SERVER_PORT = 1234
; Allows to choose the webserver port, if the webserver module is active
WEBSERVER_PORT = 8080
; Enables file journaling
JOURNALING = True
; Journal files
JOURNAL_DIR = /some/dir
; Time to launch light-on events, in HH:mm format. Set to auto to get sunset time from EVENT_LOCALIZATION.
EVENT_HOUR = 18:00
; Get this code from https://weather.com/weather/today/l/(THIS IS THE CODE), when searching for your city.
EVENT_LOCALIZATION =
; Hour of day to start accepting TCP socket-based requests, in hh:mm format 
TCP_START_HOUR = 18:00
; Hour of day to start refusing TCP socket-based requests, in hh:mm format 
TCP_END_HOUR = 23:30
; Loads the tensorflow DNN apparatus and enables wifi-rtt requests (android app not yet published)
ENABLE_WIFI_RTT = false
; Enables or disables logged and in-file debug
ENABLE_DEBUG = True
; Number of history debug files to keep
MAX_DEBUG_FILES = 3
; Modules to load
MODULES = webserver,ifttt,detector,weblog
; Available languages up to now: en, fr
LANGUAGE = en

[WEBSERVER]
; Optional. Set some device groups as rooms. The devices will be merged together on the webserver interface.
ROOM_GROUPS = livingroom,kitchen

; Device-on-lan IP detection and event triggering configurables
[DETECTOR]
; Local IPs to track status. Comma-separated. You can also add untracked users using an underscore "_" which will show their picture on the webui only.
TRACKED_IPS = 192.168.1.60,192.168.1.70,_
; Optional. This allows to show a picture of the people who owns the devices listed in TRACKED_IPS on the webserver as well as
; their presence status. Pictures are stored in the /web/images folder and you must provide the same number of pictures as
; there are TRACKED_IPS. Comma-separated.
TRACKED_PICTURES = myself.jpg,mycatwhoownsacellphone.jpg,someperson.jpg
; Number of successful pings required to trigger an event change
; Needed because some devices do turn off and on their wifi from time to time
MAX_STATE_LEVEL = 3
; Name of device group that will turn ON on detected devices, after START_HOUR
AUTO_ON_GROUP = livingroom
; Ping frequency in seconds
PING_FREQ_SEC = 10
; Enables connection to a FIND3 Docker server (True/False)
FIND3_SERVER_ENABLE = True
; The FIND3 server address:port
FIND3_SERVER_URL = raspberrypi:8005
; The FIND3 given family name
FIND3_FAMILY_NAME = my-family
; The tracked devices, comma separated. They should correspond to the TRACKED_IPS list (first device correspond to first
; tracked IP, second device to second IP...). Devices that are not tracked by FIND3 should be named with a "_".
FIND3_TRACKED_DEVICES = _,my-device2
; Hours of day to start/stop device pinging, to allow mobile going to sleep or prevent unwanted actions.
START_HOUR = 06:00
END_HOUR = 23:00
; If true, will set all devices back to AUTO mode when tracked IPs are all offline.
FALLBACK_AUTO_ON_DISCONNECT = True
; If true, will set all devices back to AUTO mode on the next day (when the detector restarts at START_HOUR)
; You might want to keep it True, as setting a device as MANUAL will prevent the detector from changing its state 
; if this is set to False
FALLBACK_AUTO_ON_NEW_DAY = True

[FIND3-PRESETS]
; FIND3 actions to run on device localized/exited room.
; Listed as: "LocationName = homeclient-command-to-run"
; Or, if left room: "LocationName-off = homeclient-command-to-run"
;
; AUTOMATIC_MODE = True runs all presets from this section as AUTO mode - which means they'll execute state changes
; on every device not actually on MANUAL mode. MANUAL has more priority over AUTO mode, and devices set in
; MANUAL mode (triggered by the command line script or via a preset in a AUTOMATIC_MODE = False category) will
; not be changed to AUTO until the --reset-mode command is sent
AUTOMATIC_MODE = True
livingroom = --on --group living --subgroup lights
livingroom-off = --off --notime --reset-mode --group living --subgroup lights

[TCP-PRESETS]
AUTOMATIC_MODE = True
livingon = --on --group livingroom --subgroup lights
livingoff = --off --group livingroom --subgroup lights

;  IFTTT server-related configurables
[IFTTT]
; Here you might want to set AUTOMATIC_MODE to False as these presets are executed by yourself vocally, and not by
; some automatic device... usually.
AUTOMATIC_MODE = False
; Random SALT string. Used in custom actions listed below
SALT = asaltstring
; Protocol used to connect to IFTTT module. If you do not have a SSL key, use http
PROTOCOL = http
; When named, priority groups will trigger a device mode change to MANUAL, preventing automatic devices from changing these
; devices afterwards.
; This is useful when you want to create turn on/off requests and then let the devices be controlled by some software, like
; Kodi. In this example below, saying "turn on the living room" would change the state of all living room devices but leave
; them in AUTO mode (so the presets/TCP/FIND3/detector would still work on them), but saying "turn on the living room lights"
; would turn on the living room lights and leave them in MANUAL mode, as you said a priority group (lights).
; Does nothing if IFTTT is configured as AUTOMATIC_MODE = True.
PRIORITY_GROUPS = lights,television
; Link to SSL key and cert, if using https
IFTTT_HTTPS_CERTS_KEY = /home/pi/.acme.sh/mazhome.ddnsfree.com/mazhome.ddnsfree.com.key
IFTTT_HTTPS_CERTS_CERT = /home/pi/.acme.sh/mazhome.ddnsfree.com/mazhome.ddnsfree.com.cer

; List actions below, as: ACTION = COMMAND_TO_RUN_ON_ACTION
; Your IFTTT Webhook should POST with a content_type application/x-www-form-urlencoded and a body:
; action=SOME_ACTION_STRING&hash=LOWERCAPS_SHA512_OF_SALT+ACTION for these actions.
; Otherwise you might want to create a generic webhook, with google assistant sending a text element
; and a body: group={{TextField}}&function=(on or off)
; This will turn on or off anything you say via the text element (groups) without any custom action
; configuration here.
some_action = --off --notime --reset-mode --group agroup
some_other_action = --tvon --reset-mode

; DIALOGFLOW server-related configurables. Not required if not used
[DIALOGFLOW]
; Dialogflow requires a HTTPS server. You can get free SSL certs and keys using the ACME script.
DIALOGFLOW_HTTPS_CERTS_KEY = /path/to/key.key
DIALOGFLOW_HTTPS_CERTS_CERT = /path/to/cert.cert
AUTOMATIC_MODE = False

; List of presets, listed as PRESET_NAME = Value_for_device0,Value_for_device1,Value_for_device2... 
; There should be as many list items as there are devices registered, or this will fail
[PRESETS]
AUTOMATIC_MODE = True
all_off = 0,0,0,0
all_on = 1,1,1,1

; BACKUP Module - allows you to backup specific linux Computers folders (including the RPi) to another
; Computer backup server. Both the clients and the backup server must either be the homeserver itself
; or a Computer-type device in this ini config.
; If you want to use the backup module without controlling your devices with Homeserver, you
; may want to add the devices with the COLOR_TYPE = noop configuration entry.
; The backups are incremental and compression is on by default.
[BACKUP]
; Delay in hours between each backups
DELAY_BETWEEN_BACKUPS = 23
; Backup server. Either write the DEVICE# of a Computer-type device or "local" to backup to the server itself
BACKUP_SERVER = 3
; Whether to launch a ON request to power-on the backup server and turn it off after the backups
BACKUP_SERVER_FORCE_ON = False
;
; Client configurations (DEVICE# or "local"). Always append each CLIENT# with a number starting from zero
; This is the first machine to backup to the server, aka CLIENT0
;
; Client 0 is DEVICE10
CLIENT0 = 10
; Whether to launch a ON request to power-on the client and turn it off after the backups
CLIENT0_FORCE_ON = False
; List of folders to backup, separated by ","
CLIENT0_FOLDERS = /home/myuser/Documents,/home/myuser/Téléchargements,/home/myuser/Images
; Destination folder on the server
CLIENT0_DESTINATION = /storage/backups/myuser
; Whether to delete files that are also deleted on CLIENT on the backup server (true sync)
CLIENT0_DELETE = True
;
; This is the second machine to backup. In this case, this is the backup server itself (you can send
; files on different disks from the same machine like that)
;
CLIENT1 = 3
CLIENT1_FORCE_ON = False
CLIENT1_FOLDERS = /home/myotheruser
CLIENT1_DESTINATION = /storage/backups/myotheruser
CLIENT1_DELETE = True

; Device configurations, listed as DEVICE0 ... DEVICE1 ... DEVICE#
; Available devices: Milight, Playbulb, DecoraSwitch
[DEVICE0]
TYPE = DecoraSwitch
; Name of device as configured in the Decora (MyLeviton) mobile app
DEVICE = A_Name
; Optional - a display name for the webserver. Will fall back to DEVICE if not defined
NAME = My Light
; Email address of MyLeviton account
EMAIL = aaa@aaa.com
; Password of MyLeviton account
PASSWORD = abcd
; Description of device
DESCRIPTION = Some Description
; Group(s) of devices (for example: same-room devices), comma separated
GROUP = agroup,asubgroup
; Default ON state intensity
DEFAULT_INTENSITY = 2

[DEVICE1]
TYPE = Playbulb
; BLE MAC address of playbulb device
ADDRESS = 00:11:22:33:44:55
; Optional - Sets a device name for the webserver. Can be applied to any device
NAME = Passageway lights
DESCRIPTION = Some playbulb
GROUP = passage,lights
; DEFAULT_INTENSITY can receive any base value, from 0-100% white intensity to ARGB color codes
DEFAULT_INTENSITY = 5
; *Not required* Always skip the time check for this device. Can be applied to any device. Default = False
SKIPTIME = True
; *Not required* Always send a OFF request, even if the state is already OFF. Can be applied to any device. Default = True
FORCEOFF = True
; *Not required* Add an icon to the device header for the webserver. Go to https://fontawesome.com/icons and note the full <i> class 
; of the chosen icon in this property (usually fa(s)(r) fa-(name-of-icon))
ICON = fas fa-traffic-light

[DEVICE2]
TYPE = Milight
; BLE MAC address of milight device
ADDRESS = 00:11:22:33:44:55
; For the following values, see https://github.com/moosd/ReverseEngineeredMiLightBluetooth/blob/master/getid.py
; Default brightness level from 1% (1) to 100% (100)
DEFAULT_INTENSITY = 50
; Default white temperature (approx.) from 2000K (2000 - yellowish) to 6500K (6500 - blueish)
DEFAULT_TEMP = 2700
ID1 = 80
ID2 = 112
DESCRIPTION = Some milight
GROUP = passage,lights

[DEVICE3]
TYPE = Computer
; Name of device
DEVICE = HTPC
DESCRIPTION = living room HTPC
GROUP = livingroom,tv
; Computer IP address and MAC address (for wakeonlan)
IP_ADDRESS = 192.168.1.2
MAC_ADDRESS = 00:11:22:33:44:55
; User to log in via SSH
SSH_USER = my_user
SKIPTIME = True
FORCEOFF = True
; *Not required* IGNOREMODE = True allows state changes independent of the actual mode. Useful for devices that should
; always be triggered by some automatic detector even though it was manually changed before - via the webserver for example. 
IGNOREMODE = True
; *Not requires* ACTION_DELAY = (seconds) allows a time delay before querying the device state. Useful for devices that
; have a boot-time delay, or lag, before they reach their final state (for example, wakeonlan and PCs). This should
; be the expected delay between the ON= request and the proper state return from the STATE= command.
ACTION_DELAY = 20

[DEVICE4]
; This is a CEC capable, HDMI connected Tv directly to the RPi (any input port on tv)
TYPE = HDMITv
DEVICE = TV
DESCRIPTION = living room TV
GROUP = livingroom,tv
IGNOREMODE = True

[DEVICE5]
TYPE = GenericOnOff
DEVICE = Sound-system
DESCRIPTION = Living room sound station
GROUP = livingroom,tv
; Some bash/sh command to run when device state should be ON
ON = irsend SEND_ONCE some-device POWER
; Some bash/sh command to run when device state should be OFF
OFF = irsend SEND_ONCE some-device POWER
; If no command exists to find device state, set to nothing
STATE =
; If this following string is found in the output (stdout) of the STATE command, consider device as ON.
STATE_ON_EXPECT =
RESTART = None
SKIPTIME = True
FORCEOFF = False
IGNOREMODE = True
; STATE_INFERENCE_GROUP is a last resort option for devices fulfilling three conditions: - A high state change failure rate, - A high probability
; chance that the device will have the same state as other devices from a group, - A device that has no means of knowing its state in real-time
; programatically. In other words, this is a device that you would often switch manually, like a sound system connected via a IR controller that often
; fails, and that its state often follows the other devices in the same group (such as a TV or a HTPC). The required value is the group name itself. 
STATE_INFERENCE_GROUP = tv

[DEVICE6]
TYPE = MerossSwitch
ADDRESS = 00:11:22:33:44:55
EMAIL = your@email.com
PASSWORD = your_password
DESCRIPTION = Some description
GROUP = livingroom,lights

[DEVICE7]
TYPE = TPLinkSwitch
DEVICE = some_room
; The device IP address as found in the TP Link mobile app after configuration
IP = 192.168.1.000 
DESCRIPTION = Smart switch in some room
GROUP = lights,room_name

[DEVICE8]
TYPE = Computer
DEVICE = MyComputer
DESCRIPTION = my own personal laptop
IP_ADDRESS = 192.168.1.3
MAC_ADDRESS = 11:22:22:33:44:66
; User to log in via SSH
SSH_USER = my_user
; COLOR_TYPE can be applied to all compatible device and forces the input color/state type (as defined in the convert module)
;
; Type noop - the device is not-editable (it only get its state). Useful if you simply want to know if your device is on or off
; or connect it to a module (for example the backup module)
COLOR_TYPE = noop
ICON = fas fa-laptop

[DEVICE9]
TYPE = TPLinkSwitch
NAME = Kitchen lights
DEVICE = kitchen
IP = 192.168.1.3
DESCRIPTION = Kitchen
GROUP = lights,home,kitchen
; This allows sending brightness (0-100%) values to the TPLink switch (for HS220 devices and dimmer switches)
DIMMABLE = True
; Default brightness (in %) when device is turned ON by the homeserver
DEFAULT_INTENSITY = 2
ICON = fas fa-lightbulb
